#
# ZYV
#

# Firewall configuration
firewall --enabled --ssh <%= ks_info['firewall'] %>

# Install OS instead of upgrade
install

# Use CDROM installation media
cdrom

# Root password
rootpw --plaintext default

# System authorization information
auth  --useshadow  --passalgo=sha512

# Use graphical install
graphical

# System keyboard
keyboard us

# System language
lang en_US.UTF-8

# SELinux configuration
selinux --enforcing

# Do not configure the X Window System
skipx

# Installation logging level
logging --level=info

# System timezone
timezone --isUtc Europe/Berlin

# Network information
network --device eth0 --bootproto=dhcp --hostname=<%= ks_guest['hostname'] %>.<%= scope.lookupvar('::domain') %>

# System bootloader configuration
bootloader --location=mbr --append="<%= ks_info['kernel'] %>"

# Clear the Master Boot Record
zerombr

# Partition clearing information
clearpart --all --initlabel

# Disk partitioning information
part / --asprimary --fstype="ext4" --fsoptions="relatime" --grow --ondisk=/dev/vda --size=1

<% if ks_guest['swap'] then %>
part swap --asprimary --fstype="swap" --grow --ondisk=/dev/vdb --size=1
<% end %>

# Local repos
repo --name="<%= ks_guest['distro'] %>-local-noarch" --baseurl="http://<%= scope.lookupvar('::hostname') %>.<%= scope.lookupvar('::domain') %>/repos/<%= ks_guest['distro'] %>-<%= ks_guest['releasever'] %>-local/noarch"
repo --name="<%= ks_guest['distro'] %>-local-binary" --baseurl="http://<%= scope.lookupvar('::hostname') %>.<%= scope.lookupvar('::domain') %>/repos/<%= ks_guest['distro'] %>-<%= ks_guest['releasever'] %>-local/<%= ks_guest['arch'] %>"

<% if ks_guest['distro'] == 'fc' then %>
repo --name="<%= ks_guest['distro'] %>-online-main" --baseurl="http://download.fedoraproject.org/pub/fedora/linux/releases/<%= ks_guest['releasever'] %>/Everything/<%= ks_guest['arch'] %>/os/"
<% end %>

# Turn off the machine upon succesfull completion
poweroff

%packages
@core
bind-utils
curl
mc
puppet
screen
vim
wget
-abrtd
-sysstat
-smartmontools

<%= ks_info['packages'] %>

%end

%post

(

# Enable puppet client installed from the internal repo
chkconfig puppet on

<%= ks_info['post'] %>

) 2>&1 | tee /root/ks-post.log

%end
