#
# ZYV
#

# Firewall configuration
firewall --enabled --ssh <%= ks_info['firewall'] %>

# Install OS instead of upgrade
install

# Use CDROM installation media
cdrom

# Root password
rootpw --plaintext default

# System authorization information
auth  --useshadow  --passalgo=sha512

# Use graphical install
graphical

# System keyboard
keyboard us

# System language
lang en_US.UTF-8

# SELinux configuration
selinux --enforcing

# Do not configure the X Window System
skipx

# Installation logging level
logging --level=info

# System timezone
timezone --isUtc Europe/Berlin

# Network information
network --bootproto=static --device=eth0 --gateway=<%= ks_info['net_gw'] %> --ip=<%= ks_info['net_ip'] %> --nameserver=<%= ks_info['net_ns'] %> --netmask=<%= ks_info['net_msk'] %> --onboot=on --noipv6 --hostname=<%= ks_info['name'] %>.<%= scope.lookupvar('::domain') %>

# System bootloader configuration
bootloader --location=mbr

# Clear the Master Boot Record
zerombr

# Partition clearing information
clearpart --all --initlabel

# Disk partitioning information
part / --asprimary --fstype="ext4" --fsoptions="relatime" --grow --ondisk=/dev/vda --size=1
part swap --asprimary --fstype="swap" --grow --ondisk=/dev/vdb --size=1

# Local repos
repo --name="<%= prefix %>-local-noarch" --baseurl="http://<%= scope.lookupvar('::hostname') %>.<%= scope.lookupvar('::domain') %>/repos/<%= prefix %>-<%= ks_info['releasever'] %>-local/noarch"
repo --name="<%= prefix %>-local-binary" --baseurl="http://<%= scope.lookupvar('::hostname') %>.<%= scope.lookupvar('::domain') %>/repos/<%= prefix %>-<%= ks_info['releasever'] %>-local/<%= ks_info['basearch'] %>"

# Turn off the machine upon succesfull completion
poweroff

%packages
@core
@server-policy
bind-utils
curl
dos2unix
mc
puppet
screen
vim
wget

<%= ks_info['packages'] %>

%post

(

# Enable puppet client installed from the internal repo
chkconfig puppet on

) 2>&1 | tee /root/ks-post.log

%end
